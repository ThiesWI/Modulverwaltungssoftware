<Window x:Class="Modulverwaltungssoftware.MainWindow"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:local="clr-namespace:Modulverwaltungssoftware"
mc:Ignorable="d"
ResizeMode="CanMinimize"
Title="Modulverwaltung – Startseite"
  Icon="logo.png"
Height="450" Width="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <!-- 1/5 -->
            <RowDefinition Height="4*" />
            <!-- 4/5 -->
        </Grid.RowDefinitions>

        <!-- OBERER Bereich -->
        <Border Grid.Row="0" Background="#F5F5F5" Padding="9">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="4*" />
                    <ColumnDefinition Width="4*" />
                    <ColumnDefinition Width="4*" />
                </Grid.ColumnDefinitions>

                <!-- Logo links oben -->
                <Button Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Top" Width="220" Height="70" Background="Transparent" BorderThickness="0" Click="LogoButton_Click" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal">
                        <Image Source="logo.png" Height="70" Width="70" Margin="0,0,8,0"/>
                        <TextBlock Text="Modulverwaltung" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Mittlere Fläche oben -->

                <!-- Rechte Seite: Notifications, Userinfo, Meine Projekte -->
                <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Top">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <!-- Notification Icon mit Badge -->
                        <Button x:Name="NotificationButton" Width="32" Height="32" Margin="0,0,10,0" ToolTip="Benachrichtigungen" Click="NotificationButton_Click" Background="Transparent" BorderThickness="0">
                            <Grid>
                                <TextBlock Text="🔔" FontSize="20" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <!-- Badge für ungelesene Anzahl -->
                                <Border x:Name="NotificationBadge" 
                                        Background="Red" 
                                        CornerRadius="10" 
                                        Width="18" Height="18"
                                        HorizontalAlignment="Right" 
                                        VerticalAlignment="Top"
                                        Margin="0,-4,-4,0"
                                        Visibility="Collapsed">
                                    <TextBlock x:Name="NotificationCount" 
                                               Text="0" 
                                               Foreground="White" 
                                               FontSize="10" 
                                               FontWeight="Bold"
                                               HorizontalAlignment="Center" 
                                               VerticalAlignment="Center"/>
                                </Border>
                            </Grid>
                        </Button>
                        
                        <!-- Notifications Popup -->
                        <Popup x:Name="NotificationsPopup" 
                               PlacementTarget="{Binding ElementName=NotificationButton}"
                               Placement="Bottom"
                               StaysOpen="False"
                               AllowsTransparency="True"
                               MaxHeight="450">
                            <Border Background="White" BorderBrush="#CCC" BorderThickness="1" 
                                    CornerRadius="5" Padding="10" Width="380">
                                <StackPanel>
                                    <TextBlock Text="Benachrichtigungen" FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>
                                    
                                    <!-- Scrollbare Liste -->
                                    <ScrollViewer MaxHeight="320" VerticalScrollBarVisibility="Auto">
                                        <ItemsControl x:Name="NotificationsList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Button Click="NotificationItem_Click" 
                                                            HorizontalContentAlignment="Stretch"
                                                            Margin="0,0,0,8"
                                                            Padding="8"
                                                            Background="#F9F9F9"
                                                            BorderBrush="#DDD"
                                                            BorderThickness="1">
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding Nachricht}" 
                                                                       TextWrapping="Wrap"
                                                                       FontWeight="SemiBold"
                                                                       Margin="0,0,0,4"/>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="Von: " FontSize="10" Foreground="Gray"/>
                                                                <TextBlock Text="{Binding Sender}" FontSize="10" Foreground="Gray" Margin="0,0,10,0"/>
                                                                <TextBlock Text="{Binding GesendetAm, StringFormat='dd.MM.yyyy HH:mm'}" 
                                                                           FontSize="10" Foreground="Gray"/>
                                                            </StackPanel>
                                                        </StackPanel>
                                                    </Button>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                    
                                    <!-- "Alle als gelesen markieren" Button -->
                                    <Button Content="Alle als gelesen markieren" 
                                            Click="MarkAllAsRead_Click" 
                                            Margin="0,10,0,0"
                                            Padding="8,6"
                                            Background="#E0E0E0"
                                            BorderThickness="0"/>
                                </StackPanel>
                            </Border>
                        </Popup>
                        
                        <!-- Userinfo -->
                        <TextBlock Text="{Binding UserInfo}" 
                           VerticalAlignment="Center" FontWeight="SemiBold"/>
                    </StackPanel>
                    <!-- Meine Projekte als Dropdown-Menü (gesamte Fläche klickbar) -->
                    <Border x:Name="ProjectsBorder" Background="#E0E0E0" CornerRadius="5" Margin="0,8,0,0">
                        <Button x:Name="ProjectsButton" Click="ToggleProjectsPopup" KeyDown="ProjectsButton_KeyDown" Background="Transparent" BorderThickness="0" Padding="4">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Meine Projekte" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Text=" ▾" Margin="6,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </Border>
                    <!-- Popup muss außerhalb des Border liegen, da Border nur ein Child zulässt -->
                    <Popup x:Name="ProjectsPopup"
                           PlacementTarget="{Binding ElementName=ProjectsButton}"
                           Placement="Bottom"
                           StaysOpen="False"
                           AllowsTransparency="True">
                        <Border Background="White" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Padding="0" Width="{Binding ElementName=ProjectsBorder, Path=ActualWidth}">
                            <ItemsControl ItemsSource="{Binding Projects}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Content="{Binding}" Click="ProjectPopupItem_Click" Background="Transparent" BorderThickness="0" Padding="8,6" HorizontalContentAlignment="Left"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Border>
                    </Popup>
                </StackPanel>
            </Grid>
        </Border>

        <!-- UNTERER Bereich für Unterseiten -->
        <Frame Grid.Row="1" x:Name="MainFrame" NavigationUIVisibility="Hidden" Margin="0,10,0,0" JournalOwnership="OwnsJournal"/>
    </Grid>
</Window>